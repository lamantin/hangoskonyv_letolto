<?php
include('simple_html_dom.php');
set_time_limit(0);



$urls= ['17148:9885:3073:5748:7604:3833:5778:3071:5893:3072:5747:3087:15612:6786:3309:17412:16093:15978:16698:15625:6058:2954:3076:4085:3179:2776:14694:15654:14696:14576:14771:14870:14575:14697:14695:7570:3310:3321:2971:2972:15200:3384:2967:13799:10519:2778:3314:3379:2952:3798:4742:5003:2388:2595:3085:3173:12115:2546:7603:2596:2751:3323:2750:2650:2402:3180:3391:7120:13632:15299:15144:15100:3994:2389:11327:9387:9405:4754:9129:7363:3082:9914:9340:10570:11242:10621:9361:10454&mod=keres&offset=100&formatum=MP3&rendezes=','http://mek.oszk.hu/html/vgi/kereses/keresesf.phtml?indextomb=10018:9475:3742:4480:12476:7793:12529:12297:2426:11676:6690:3086:13793:11382:17051:2401:3319:3320:3378:3386:14776:15812:13810:13790:5354:2569:2359:2358:2328:3313:9700:2363:2367:4248:4787:3081:4788:4481:2660:11241:2376:9059:7027:2287:14727:6566:4741:12013:12058:12244:15626:17713:11545:11319:2581:2580:10945:2616:11236:2547:1329:1897:1895:1611:6059:9639:10505:14639:17009:10874:16079:12892:6840:15513:15993:2651:3380:16296:15201:14924:14800:16149:3987:5312:2386:9586:2387:2289:3986:3306:3743:7625:3308:4771:3305:2568:9931:6060:10222:3985&mod=keres&offset=200&formatum=MP3&rendezes=','http://mek.oszk.hu/html/vgi/kereses/keresesf.phtml?indextomb=3168:3385:5486:7547:3075:11390:4748:3307:11267:12409:12410:12107:14010:11999:16225:12181:11304:7736:8399:15104:4763:11029:13959:8959:8958:12231:2377:3295:2368:2417:2423:15349:8956:8799:2268:8789:3304:2403:2579:4747:15638:12379:12367:16012:12397:12398:12445:12464:2545:12471:12368:12453:12369:12439:12419:12446:2544:12722:12454:12377:2953:12462:12378:2966:12723:3172:12421:12396:12463:12420:12447:2787:2788:3322:4769:4770:2800:2614:3166:3799:12066:6233:7036:3980:4249:3181:3376:5313:11247:12199:6795:3170:2965:3740:3741:2970:3171:11747:6785:6252&mod=keres&offset=300&formatum=MP3&rendezes='];

$list = "";


for ($i=0;$i<count($urls);$i++){
	$url = $urls[$i];
	$exec = "lynx -dump '{$url}'  | awk '/http/{print $2}'";	
	$item = shell_exec($exec);
	$skuList =explode("\n", $item);
	$list.=rtrim(implode(',', $skuList), ',');
}


$mp3Urls=[];

$l = explode(',',$list);

foreach ($l as $key => $value) {
	if(strlen($value)>40 ||$value===$main_url){
		unset($l[$key]);
	} else{
		$mp3Urls[]=$value.'/mp3/';
	}
		
}

$MP3=[];
foreach ($mp3Urls as $key => $value) {
	
	$html = @file_get_html($value);
	$title = "";
	if(is_bool($html)){} else{

		$title = $html->find('table', -2)->plaintext;
		print $title.PHP_EOL;
		$skuList =array_filter(explode("\n", $title));
		array_pop($skuList); 
		$title =trim(implode(" ",$skuList));
		
		$exec = "lynx -dump '{$value}'  | awk '/http/{print $2}'";
		$item = shell_exec($exec);
		$skuList =explode("\n", $item);
		$MP3[]=array('url'=>$value,'cim'=>trim($title),'files'=>$skuList);
		
	}
}
